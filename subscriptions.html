<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إدارة الاشتراكات</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        /* إضافة الأنماط الخاصة بك */
        /* ... */
        
        .notification-icon {
            color: #4CAF50;
            font-size: 20px;
            margin-left: 10px;
            display: none;
        }

        .button-group {
            display: flex;
            justify-content: space-between;
        }

        .button-group .button {
            margin: 0 5px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="sidebar">
            <h2>إدارة الجيم</h2>
            <!-- التنقل الجانبي -->
        </div>

        <div class="content">
            <h3>إدارة الاشتراكات</h3>
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="بحث عن اشتراك...">
                <button class="button" id="addSubscriptionBtn">إضافة اشتراك</button>
                <button class="button button-red" id="renewSubscriptionBtn">تجديد الاشتراك</button>
                <span class="notification-icon" id="notificationIcon"><i class="fas fa-bell"></i></span>
            </div>
            <table id="subscriptionsTable">
                <thead>
                    <tr>
                        <th>اسم المشترك</th>
                        <th>الاشتراك</th>
                        <th>تاريخ البدء</th>
                        <th>تاريخ الانتهاء</th>
                        <th>الإجراءات</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- الاشتراكات سيتم إضافتها هنا -->
                </tbody>
            </table>
        </div>
    </div>

    <div id="renewModal" class="modal">
        <!-- نافذة تجديد الاشتراك -->
    </div>

    <script>
        const subscriptionsKey = "gymSubscriptions";
        const renewalKey = "gymRenewals";

        function loadSubscriptions() {
            const storedSubscriptions = localStorage.getItem(subscriptionsKey);
            if (storedSubscriptions) {
                return JSON.parse(storedSubscriptions);
            }
            return [];
        }

        function saveSubscriptions(subscriptions) {
            localStorage.setItem(subscriptionsKey, JSON.stringify(subscriptions));
        }

        function loadRenewals() {
            const storedRenewals = localStorage.getItem(renewalKey);
            if (storedRenewals) {
                return JSON.parse(storedRenewals);
            }
            return [];
        }

        function saveRenewals(renewals) {
            localStorage.setItem(renewalKey, JSON.stringify(renewals));
        }

        // إضافة اشتراك
        document.getElementById("addSubscriptionBtn").addEventListener("click", function() {
            Swal.fire({
                title: 'إضافة اشتراك جديد',
                html: 
                    '<input type="text" id="subscriberName" class="swal2-input" placeholder="اسم المشترك">' +
                    '<input type="text" id="subscriptionType" class="swal2-input" placeholder="الاشتراك">' +
                    '<input type="date" id="startDate" class="swal2-input">' +
                    '<input type="date" id="endDate" class="swal2-input">',
                confirmButtonText: 'إضافة',
                preConfirm: () => {
                    const subscriberName = document.getElementById("subscriberName").value;
                    const subscriptionType = document.getElementById("subscriptionType").value;
                    const startDate = document.getElementById("startDate").value;
                    const endDate = document.getElementById("endDate").value;

                    if (!subscriberName || !subscriptionType || !startDate || !endDate) {
                        Swal.showValidationMessage("يرجى ملء جميع الحقول");
                        return false;
                    }

                    const newSubscription = {
                        subscriberName,
                        subscriptionType,
                        startDate,
                        endDate
                    };

                    const subscriptions = loadSubscriptions();
                    subscriptions.push(newSubscription);
                    saveSubscriptions(subscriptions);
                    loadTableData();
                    document.getElementById("notificationIcon").style.display = 'inline';
                }
            });
        });

        // تجديد الاشتراك
        document.getElementById("renewSubscriptionBtn").addEventListener("click", function() {
            const renewals = loadRenewals();
            const renewModal = document.getElementById("renewModal");
            const renewalTable = document.getElementById("renewalTable").getElementsByTagName('tbody')[0];

            renewalTable.innerHTML = '';

            renewals.forEach(renewal => {
                const row = renewalTable.insertRow();
                row.insertCell(0).innerText = renewal.subscriberName;
                row.insertCell(1).innerText = renewal.subscriptionType;
                row.insertCell(2).innerText = renewal.endDate;
                row.insertCell(3).innerHTML = `<button class="button" onclick="renewSubscription('${renewal.subscriberName}')">تجديد</button>`;
            });

            renewModal.style.display = "block";
        });

        // إغلاق نافذة التجديد
        document.querySelector(".close").addEventListener("click", function() {
            document.getElementById("renewModal").style.display = "none";
        });

        // تجديد الاشتراك
        function renewSubscription(subscriberName) {
            const subscriptions = loadSubscriptions();
            const renewalDate = new Date();
            const renewalEndDate = new Date(renewalDate);
            renewalEndDate.setMonth(renewalEndDate.getMonth() + 1);

            const subscription = subscriptions.find(sub => sub.subscriberName === subscriberName);
            if (subscription) {
                subscription.endDate = renewalEndDate.toISOString().split('T')[0];
                saveSubscriptions(subscriptions);
                loadTableData();
                Swal.fire("تم تجديد الاشتراك بنجاح!");
            }
        }

        // تحميل البيانات إلى الجدول
        function loadTableData() {
            const subscriptions = loadSubscriptions();
            const tableBody = document.querySelector("#subscriptionsTable tbody");
            tableBody.innerHTML = '';

            subscriptions.forEach(subscription => {
                const row = tableBody.insertRow();
                row.insertCell(0).innerText = subscription.subscriberName;
                row.insertCell(1).innerText = subscription.subscriptionType;
                row.insertCell(2).innerText = subscription.startDate;
                row.insertCell(3).innerText = subscription.endDate;
                const actionsCell = row.insertCell(4);
                actionsCell.innerHTML = `
                    <div class="button-group">
                        <button class="button" onclick="editSubscription('${subscription.subscriberName}')">تعديل</button>
                        <button class="button button-red" onclick="deleteSubscription('${subscription.subscriberName}')">حذف</button>
                    </div>
                `;
            });
        }

        // تعديل الاشتراك
        function editSubscription(subscriberName) {
            const subscriptions = loadSubscriptions();
            const subscription = subscriptions.find(sub => sub.subscriberName === subscriberName);
            if (subscription) {
                Swal.fire({
                    title: 'تعديل الاشتراك',
                    html: 
                        `<input type="text" id="subscriberName" class="swal2-input" value="${subscription.subscriberName}" placeholder="اسم المشترك">` +
                        `<input type="text" id="subscriptionType" class="swal2-input" value="${subscription.subscriptionType}" placeholder="الاشتراك">` +
                        `<input type="date" id="startDate" class="swal2-input" value="${subscription.startDate}">` +
                        `<input type="date" id="endDate" class="swal2-input" value="${subscription.endDate}">`,
                    confirmButtonText: 'تعديل',
                    preConfirm: () => {
                        const subscriberName = document.getElementById("subscriberName").value;
                        const subscriptionType = document.getElementById("subscriptionType").value;
                        const startDate = document.getElementById("startDate").value;
                        const endDate = document.getElementById("endDate").value;

                        if (!subscriberName || !subscriptionType || !startDate || !endDate) {
                            Swal.showValidationMessage("يرجى ملء جميع الحقول");
                            return false;
                        }

                        subscription.subscriberName = subscriberName;
                        subscription.subscriptionType = subscriptionType;
                        subscription.startDate = startDate;
                        subscription.endDate = endDate;
                        saveSubscriptions(subscriptions);
                        loadTableData();
                    }
                });
            }
        }

        // حذف الاشتراك
        function deleteSubscription(subscriberName) {
            Swal.fire({
                title: 'هل أنت متأكد؟',
                text: "لا يمكن التراجع عن هذا الإجراء!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'نعم، حذف الاشتراك!'
            }).then(result => {
                if (result.isConfirmed) {
                    const subscriptions = loadSubscriptions();
                    const updatedSubscriptions = subscriptions.filter(sub => sub.subscriberName !== subscriberName);
                    saveSubscriptions(updatedSubscriptions);
                    loadTableData();
                    Swal.fire('تم الحذف!', 'تم حذف الاشتراك بنجاح.', 'success');
                }
            });
        }

        loadTableData();
    </script>
</body>
</html>
