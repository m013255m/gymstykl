<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إدارة الاشتراكات</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h2>إدارة الاشتراكات</h2>
    <table id="subscriptionsTable">
        <thead>
            <tr>
                <th>اسم العضو</th>
                <th>نوع الاشتراك</th>
                <th>تاريخ البداية</th>
                <th>تاريخ النهاية</th>
                <th>الإجراءات</th>
            </tr>
        </thead>
        <tbody>
            <!-- سيتم إضافة البيانات هنا -->
        </tbody>
    </table>

    <script>
        $(document).ready(function() {
            // تحميل الاشتراكات من localStorage إذا كانت موجودة
            const subscriptions = localStorage.getItem("subscriptions");
            if (subscriptions) {
                $("#subscriptionsTable tbody").html(subscriptions);
            }

            // إضافة اشتراك جديد
            $("#addSubscription").click(function() {
                const memberName = prompt("أدخل اسم العضو:");
                const subscriptionType = prompt("أدخل نوع الاشتراك:");
                const startDate = prompt("أدخل تاريخ البداية (YYYY-MM-DD):");
                const endDate = prompt("أدخل تاريخ النهاية (YYYY-MM-DD):");

                if (memberName && subscriptionType && startDate && endDate) {
                    const newRow = `<tr>
                        <td>${memberName}</td>
                        <td>${subscriptionType}</td>
                        <td>${startDate}</td>
                        <td>${endDate}</td>
                        <td>
                            <button onclick="editSubscription(this)">تعديل</button>
                            <button onclick="deleteSubscription(this)">حذف</button>
                        </td>
                    </tr>`;
                    $("#subscriptionsTable tbody").append(newRow);
                    localStorage.setItem("subscriptions", $("#subscriptionsTable tbody").html());
                }
            });

            // إظهار الاشتراكات المنتهية
            $("#showExpired").click(function() {
                const currentDate = new Date().toISOString().split("T")[0];
                let expiredTable = "";
                $("#subscriptionsTable tbody tr").each(function() {
                    const endDate = $(this).find("td").eq(3).text();
                    if (endDate < currentDate) {
                        expiredTable += $(this).prop("outerHTML");
                    }
                });
                if (expiredTable) {
                    Swal.fire({
                        title: "الاشتراكات المنتهية",
                        html: expiredTable,
                        showCloseButton: true,
                        focusConfirm: false
                    });
                } else {
                    Swal.fire("لا يوجد اشتراكات منتهية", "", "info");
                }
            });
        });

        function editSubscription(button) {
            const row = $(button).closest("tr");
            const memberName = row.find("td").eq(0).text();
            const subscriptionType = row.find("td").eq(1).text();
            const startDate = row.find("td").eq(2).text();
            const endDate = row.find("td").eq(3).text();

            Swal.fire({
                title: "تعديل الاشتراك",
                html:
                    `<input type="text" id="memberNameEdit" class="swal2-input" value="${memberName}">` +
                    `<input type="text" id="subscriptionTypeEdit" class="swal2-input" value="${subscriptionType}">` +
                    `<input type="date" id="startDateEdit" class="swal2-input" value="${startDate}">` +
                    `<input type="date" id="endDateEdit" class="swal2-input" value="${endDate}">`,
                confirmButtonText: "حفظ التعديلات",
                showCancelButton: true,
                cancelButtonText: "إلغاء",
                preConfirm: () => {
                    const updatedMemberName = $("#memberNameEdit").val();
                    const updatedSubscriptionType = $("#subscriptionTypeEdit").val();
                    const updatedStartDate = $("#startDateEdit").val();
                    const updatedEndDate = $("#endDateEdit").val();

                    row.find("td").eq(0).text(updatedMemberName);
                    row.find("td").eq(1).text(updatedSubscriptionType);
                    row.find("td").eq(2).text(updatedStartDate);
                    row.find("td").eq(3).text(updatedEndDate);
                    localStorage.setItem("subscriptions", $("#subscriptionsTable tbody").html());
                    Swal.fire("تم!", "تم تعديل الاشتراك بنجاح.", "success");
                }
            });
        }

        function deleteSubscription(button) {
            const row = $(button).closest("tr");
            row.remove();
            localStorage.setItem("subscriptions", $("#subscriptionsTable tbody").html());
            Swal.fire("تم!", "تم حذف الاشتراك بنجاح.", "success");
        }
    </script>
</body>
</html>
