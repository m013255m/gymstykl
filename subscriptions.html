<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إدارة الاشتراكات</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        /* هنا توضع جميع التنسيقات السابقة */
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h2>إدارة الجيم</h2>
            <nav>
                <ul>
                    <li><a href="index.html">الرئيسية</a></li>
                    <li><a href="subscriptions.html">إدارة الاشتراكات</a></li>
                </ul>
            </nav>
        </div>

        <div class="content">
            <h3>إدارة الاشتراكات</h3>
            <div class="button-container">
                <button class="button red-button" id="renewSubscriptionBtn">تجديد الاشتراكات</button>
            </div>
            <table id="subscriptionsTable">
                <thead>
                    <tr>
                        <th>اسم العضو</th>
                        <th>نوع الاشتراك</th>
                        <th>تاريخ البداية</th>
                        <th>تاريخ النهاية</th>
                        <th>الإجراءات</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- البيانات ستُضاف هنا ديناميكيًا -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- مربع منبثق لتعديل تاريخ نهاية الاشتراك -->
    <div class="popup" id="renewPopup">
        <div class="popup-content">
            <h2>إضافة مدة إضافية</h2>
            <input type="date" id="newEndDateInput">
            <button class="button" id="saveNewEndDateBtn">حفظ</button>
            <button class="button red-button" id="cancelRenewPopupBtn">إلغاء</button>
        </div>
    </div>

    <div class="overlay" id="popupOverlay"></div>

    <script>
        $(document).ready(function () {
            // تحميل البيانات
            if (localStorage.getItem("subscriptions")) {
                $("#subscriptionsTable tbody").html(localStorage.getItem("subscriptions"));
            }

            // زر تجديد الاشتراكات
            $("#renewSubscriptionBtn").click(function () {
                const expiredMembers = [];
                $("#subscriptionsTable tbody tr").each(function () {
                    const endDate = new Date($(this).find("td:eq(3)").text());
                    const today = new Date();
                    if (endDate < today) {
                        expiredMembers.push($(this).clone());
                    }
                });

                if (expiredMembers.length > 0) {
                    const popupTable = $("<table></table>").append(
                        "<thead><tr><th>اسم العضو</th><th>نوع الاشتراك</th><th>تاريخ البداية</th><th>تاريخ النهاية</th><th>إجراء</th></tr></thead>"
                    );
                    const popupBody = $("<tbody></tbody>");
                    expiredMembers.forEach(row => {
                        const extraButton = $("<button></button>")
                            .addClass("button")
                            .text("مدة إضافية")
                            .click(function () {
                                const selectedRow = row;
                                $("#popupOverlay").fadeIn();
                                $("#renewPopup").fadeIn();

                                $("#saveNewEndDateBtn").off("click").click(function () {
                                    const newEndDate = $("#newEndDateInput").val();
                                    if (newEndDate) {
                                        selectedRow.find("td:eq(3)").text(newEndDate);
                                        localStorage.setItem("subscriptions", $("#subscriptionsTable tbody").html());
                                        $("#popupOverlay").fadeOut();
                                        $("#renewPopup").fadeOut();
                                        alert("تم تجديد الاشتراك!");
                                    } else {
                                        alert("يرجى إدخال تاريخ النهاية الجديد.");
                                    }
                                });
                            });

                        row.append($("<td></td>").append(extraButton));
                        popupBody.append(row);
                    });

                    popupTable.append(popupBody);
                    $("body").append(popupTable);
                } else {
                    alert("لا يوجد أعضاء بحاجة إلى تجديد.");
                }
            });

            // إغلاق مربع المدة الإضافية
            $("#cancelRenewPopupBtn").click(function () {
                $("#popupOverlay").fadeOut();
                $("#renewPopup").fadeOut();
            });
        });
    </script>
</body>
</html>
